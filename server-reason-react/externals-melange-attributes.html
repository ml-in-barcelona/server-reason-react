<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>externals-melange-attributes (server-reason-react.externals-melange-attributes)</title><meta charset="utf-8"/><link rel="stylesheet" href="../odoc.css"/><meta name="generator" content="odoc 3.1.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script><script>let base_url = '../';
let search_urls = ['sherlodoc_db.js','../sherlodoc.js'];
</script><script src="../odoc_search.js" defer="defer"></script></head><body class="odoc"><nav class="odoc-nav"><a href="index.html">Up</a> â€“ <a href="../index.html">Package index</a> &#x00BB; <a href="index.html">server-reason-react</a> &#x00BB; Externals and melange attributes</nav><div class="odoc-search"><div class="search-inner"><input class="search-bar" placeholder="ðŸ”Ž Type '/' to search..."/><div class="search-snake"></div><div class="search-result"></div></div></div><header class="odoc-preamble"><h1 id="externals-and-melange-attributes"><a href="#externals-and-melange-attributes" class="anchor"></a>Externals and melange attributes</h1><p><code>melange.ppx</code> is designed to preprocess Melange programs (simplifying code generation for common use cases like generating bindings or code from types). It's not compatible with native, but if you want to share a module with <code>melange.ppx</code> we provide a drop-in replacement called: <code>server-reason-react.melange_ppx</code>.</p><p>Most of the features are shimmed to not work on the server and the compiler will warn to wrap it in <code>browser_only</code> expressions.</p></header><div class="odoc-tocs"><nav class="odoc-toc odoc-local-toc"><ul><li><a href="#server-reason-react.melange_ppx-supports"><code>server-reason-react.melange_ppx</code> supports</a><ul><li><a href="#all-mel.-attributes">All <code>mel.</code> attributes</a></li><li><a href="#enables-pipe_first--&gt;">Enables pipe_first <code>-&gt;</code></a></li><li><a href="#supports-regexp-[%re-&quot;/regex/&quot;]">Supports RegExp <code>[%re &quot;/regex/&quot;]</code></a></li><li><a href="#debugger-%debugger">Debugger <code>%debugger</code></a></li><li><a href="#supports-js.t-(object-access-##-and-mel.obj)">Supports Js.t (object access <code>##</code> and mel.obj)</a></li><li><a href="#supports-[@@deriving-jsconverter]">Supports <code>[@@deriving jsConverter]</code></a></li></ul></li><li><a href="#usage">Usage</a></li></ul></nav><nav class="odoc-toc odoc-global-toc"><ul><li><a href="index.html">server-reason-react</a><ul><li><a href="get-started.html">Get started</a></li><li><a href="universal-code.html">What does universal code mean</a></li><li><a href="how-to-organise-universal-code.html">How to organise universal code</a></li><li><a href="browser_ppx.html">Exclude client code from the native build</a></li><li><a href="#" class="current_unit">Externals and melange attributes</a></li><li><a href="ssr-and-hydration.html">Server-side rendering and hydration</a></li><li>Library <code>server-reason-react.base32</code><ul><li><a href="server-reason-react.base32/Base32/index.html">Base32</a></li></ul></li><li>Library <code>server-reason-react.belt</code><ul><li><a href="server-reason-react.belt/Belt/index.html">Belt</a></li></ul></li><li>Library <code>server-reason-react.browser_ppx</code><ul><li><a href="server-reason-react.browser_ppx/Browser_ppx/index.html">Browser_ppx</a></li></ul></li><li>Library <code>server-reason-react.dom</code><ul><li><a href="server-reason-react.dom/Dom/index.html">Dom</a></li></ul></li><li>Library <code>server-reason-react.expand-styles-attribute</code><ul><li><a href="server-reason-react.expand-styles-attribute/Expand_styles_attribute/index.html">Expand_styles_attribute</a></li></ul></li><li>Library <code>server-reason-react.fetch</code><ul><li><a href="server-reason-react.fetch/Fetch/index.html">Fetch</a></li></ul></li><li>Library <code>server-reason-react.html</code><ul><li><a href="server-reason-react.html/Html/index.html">Html</a></li></ul></li><li>Library <code>server-reason-react.js</code><ul><li><a href="server-reason-react.js/Js/index.html">Js</a></li></ul></li><li>Library <code>server-reason-react.melange_ppx</code><ul><li><a href="server-reason-react.melange_ppx/Melange_native_ppx/index.html">Melange_native_ppx</a></li></ul></li><li>Library <code>server-reason-react.ppx</code><ul><li><a href="server-reason-react.ppx/Server_reason_react_ppx/index.html">Server_reason_react_ppx</a></li></ul></li><li>Library <code>server-reason-react.promise-native</code><ul><li><a href="server-reason-react.promise-native/Promise/index.html">Promise</a></li></ul></li><li>Library <code>server-reason-react.react</code><ul><li><a href="server-reason-react.react/React/index.html">React</a></li><li><a href="server-reason-react.react/ReactEvent/index.html">ReactEvent</a></li><li><a href="server-reason-react.react/ReasonReactRouter/index.html">ReasonReactRouter</a></li></ul></li><li>Library <code>server-reason-react.reactDom</code><ul><li><a href="server-reason-react.reactDom/ReactDOM/index.html">ReactDOM</a></li><li><a href="server-reason-react.reactDom/ReactDOMStyle/index.html">ReactDOMStyle</a></li><li><a href="server-reason-react.reactDom/ReactServerDOM/index.html">ReactServerDOM</a></li></ul></li><li>Library <code>server-reason-react.runtime</code><ul><li><a href="server-reason-react.runtime/Runtime/index.html">Runtime</a></li></ul></li><li>Library <code>server-reason-react.url_native</code><ul><li><a href="server-reason-react.url_native/URL/index.html">URL</a></li></ul></li><li>Library <code>server-reason-react.webapi</code><ul><li><a href="server-reason-react.webapi/Webapi/index.html">Webapi</a></li></ul></li><li>Library <code>server-reason-react.xxhash</code><ul><li><a href="server-reason-react.xxhash/XXH64/index.html">XXH64</a></li></ul></li><li><a href="src/index.html">Sources</a></li></ul></li></ul></nav></div><div class="odoc-content"><h2 id="server-reason-react.melange_ppx-supports"><a href="#server-reason-react.melange_ppx-supports" class="anchor"></a><code>server-reason-react.melange_ppx</code> supports</h2><h3 id="all-mel.-attributes"><a href="#all-mel.-attributes" class="anchor"></a>All <code>mel.</code> attributes</h3><p>mel.* attributes are stripped out of the native build, and transformed into raising functions to raise at server runtime.</p><h3 id="enables-pipe_first--&gt;"><a href="#enables-pipe_first--&gt;" class="anchor"></a>Enables pipe_first <code>-&gt;</code></h3><p>Pipe first is the operator to apply a function to a value where data is passed as the first argument. <code>-&gt;</code> is a convenient operator that allows you to &quot;flip&quot; your code inside-out.</p><p>It's not supported in native OCaml, but <code>server-reason-react.melange_ppx</code> enables it and works as expected.</p><h3 id="supports-regexp-[%re-&quot;/regex/&quot;]"><a href="#supports-regexp-[%re-&quot;/regex/&quot;]" class="anchor"></a>Supports RegExp <code>[%re &quot;/regex/&quot;]</code></h3><p>Transforms <code>[%re ...]</code> into <code>Js.Re.t</code> from <code>server-reason-react.js</code> and it uses a C implementation of the regex engine from QuickJS from <a href="https://github.com/ml-in-barcelona/quickjs.ml">quickjs.ml</a>. (Experimental)</p><h3 id="debugger-%debugger"><a href="#debugger-%debugger" class="anchor"></a>Debugger <code>%debugger</code></h3><p>It removes the debugger in native. It's a noop on the server context, and it's pretty uncommon it's usage.</p><h3 id="supports-js.t-(object-access-##-and-mel.obj)"><a href="#supports-js.t-(object-access-##-and-mel.obj)" class="anchor"></a>Supports Js.t (object access <code>##</code> and mel.obj)</h3><pre class="language-ocaml"><code>let john = {&quot;name&quot;: &quot;john&quot;, &quot;age&quot;: 99};
/* The type of john is `{ . &quot;age&quot;: int, &quot;name&quot;: string }` which represents a
JavaScript Object. */
let name = john##name;</code></pre><p>https://melange.re/v3.0.0/communicate-with-javascript.html#using-js-t-objects</p><p>Object creation and object field access is designed to interact with JavaScript Objects, in native we reperesent those as OCaml Objects (which are very different) and <code>server-reason-react-ppx.melange_ppx</code> proviedes the implementation to make it work. (Experimental)</p><h3 id="supports-[@@deriving-jsconverter]"><a href="#supports-[@@deriving-jsconverter]" class="anchor"></a>Supports <code>[@@deriving jsConverter]</code></h3><p>The <code>jsConverter</code> deriver generates conversion functions between OCaml variants and JavaScript-friendly representations (integers for regular variants, strings for polymorphic variants).</p><p><b>Regular variants:</b></p><pre class="language-ocaml"><code>type action = Click | Submit | Cancel [@@deriving jsConverter]
(* Generates:
   val actionToJs : action -&gt; int
   val actionFromJs : int -&gt; action option *)</code></pre><p><b>Polymorphic variants:</b></p><pre class="language-ocaml"><code>type state = [`Idle | `Loading | `Error] [@@deriving jsConverter]
(* Generates:
   val stateToJs : state -&gt; string
   val stateFromJs : string -&gt; state option *)</code></pre><p><b>With <code>\@mel.as</code> to customize values:</b></p><pre class="language-ocaml"><code>type action = Click | Submit [@mel.as 3] | Cancel [@@deriving jsConverter]
(* Click = 0, Submit = 3, Cancel = 4 *)</code></pre><p><b>With <code>{ newType }</code> for abstract types:</b></p><pre class="language-ocaml"><code>type action = Click | Submit [@@deriving jsConverter { newType }]
(* Generates an abstract type [abs_action] and:
   val actionToJs : action -&gt; abs_action
   val actionFromJs : abs_action -&gt; action *)</code></pre><p>Note: Only variants without payloads are supported. Variants with payloads like <code>Submit of int</code> will produce a compile-time error.</p><h2 id="usage"><a href="#usage" class="anchor"></a>Usage</h2><p>To use <code>server-reason-react.melange_ppx</code> you need to add it to your dune's pps field:</p><pre class="language-ocaml"><code> (preprocess (pps server-reason-react.melange_ppx)) </code></pre></div></body></html>
